<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Quiz Cam Wiki</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- OCR IA locale (sans API) -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body {
    background: #0f0f0f;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
}

h2 {
    margin-top: 10px;
}

video {
    width: 100%;
    max-width: 400px;
    border-radius: 12px;
    margin-top: 10px;
}

button {
    background: #00ff88;
    border: none;
    padding: 12px;
    font-size: 16px;
    border-radius: 10px;
    margin-top: 10px;
}

#result {
    margin-top: 15px;
    font-size: 18px;
}

.good {
    color: #00ff00;
    font-size: 22px;
    font-weight: bold;
}
</style>
</head>

<body>

<h2>ðŸ“¸ Quiz Cam Wiki</h2>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" hidden></canvas>

<br>
<button onclick="capture()">Scanner la question</button>

<div id="result"></div>

<script>
// ===== 1. ACTIVER LA CAMÃ‰RA =====
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const result = document.getElementById("result");

navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" }
}).then(stream => {
    video.srcObject = stream;
}).catch(() => {
    alert("Autorise la camÃ©ra");
});

// ===== 2. PRENDRE LA PHOTO =====
function capture() {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);
    result.innerHTML = "â³ Analyse OCR...";
    readText();
}

// ===== 3. OCR (LECTURE DU TEXTE) =====
function readText() {
    Tesseract.recognize(canvas, "fra").then(res => {
        analyzeText(res.data.text);
    }).catch(() => {
        result.innerText = "Erreur OCR";
    });
}

// ===== 4. ANALYSE A B C D =====
function analyzeText(text) {
    const lines = text.split("\n").map(l => l.trim()).filter(l => l);
    let question = "";
    let A="", B="", C="", D="";

    lines.forEach(line => {
        if (line.startsWith("A")) A = line;
        else if (line.startsWith("B")) B = line;
        else if (line.startsWith("C")) C = line;
        else if (line.startsWith("D")) D = line;
        else question += line + " ";
    });

    if (!question) {
        result.innerText = "Question non dÃ©tectÃ©e";
        return;
    }

    searchWikipedia(question, A, B, C, D);
}

// ===== 5. WIKIPÃ‰DIA (SANS API) =====
function searchWikipedia(question, A, B, C, D) {
    result.innerHTML = "ðŸ”Ž Recherche WikipÃ©dia...";

    const url = "https://fr.wikipedia.org/api/rest_v1/page/summary/" +
                encodeURIComponent(question);

    fetch(url)
    .then(res => res.json())
    .then(data => {
        const wikiText = JSON.stringify(data).toLowerCase();

        const scores = {
            A: count(wikiText, A),
            B: count(wikiText, B),
            C: count(wikiText, C),
            D: count(wikiText, D)
        };

        const best = Object.keys(scores).reduce((a, b) =>
            scores[a] > scores[b] ? a : b
        );

        result.innerHTML = `
            <div class="good">â­• RÃ©ponse probable : ${best}</div>
            <div>${A}<br>${B}<br>${C}<br>${D}</div>
        `;
    })
    .catch(() => {
        result.innerText = "WikipÃ©dia introuvable";
    });
}

// ===== 6. COMPTAGE DES MOTS =====
function count(text, word) {
    if (!word) return 0;
    const w = word.toLowerCase();
    return (text.match(new RegExp(w, "g")) || []).length;
}
</script>

</body>
</html>
