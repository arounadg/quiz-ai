<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>AI Quiz Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body {
  margin: 0;
  background: #0b0b0b;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}
#video {
  width: 100%;
  height: 100vh;
  object-fit: cover;
}
#overlay {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: rgba(0,0,0,0.7);
  padding: 15px;
}
button {
  padding: 15px 25px;
  font-size: 18px;
  border-radius: 10px;
  border: none;
  background: #00e676;
  color: black;
}
.answer {
  margin-top: 10px;
  padding: 10px;
  border-radius: 8px;
}
.correct {
  background: #00e676;
  color: black;
}
.wrong {
  background: #555;
}
</style>
</head>

<body>

<video id="video" autoplay muted></video>

<div id="overlay">
  <button onclick="startCamera()">üì∑ Activer la cam√©ra</button>
  <div id="result"></div>
</div>

<script>
let video = document.getElementById("video");
let resultDiv = document.getElementById("result");
let streamStarted = false;

async function startCamera() {
  if (streamStarted) return;
  streamStarted = true;

  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" }
  });
  video.srcObject = stream;

  // scanner toutes les 3 secondes pour √©conomiser le cr√©dit
  setInterval(scanFrame, 3000);
}

async function scanFrame() {
  if (!video.videoWidth) return;

  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0);

  const { data: { text } } = await Tesseract.recognize(canvas, "fra+eng");

  if (text.length < 30) return; // ignorer les textes trop courts

  analyzeWithAI(text);
}

async function analyzeWithAI(text) {
  resultDiv.innerHTML = "‚è≥ Analyse IA...";

  const prompt = `
Question de quiz :
${text}

Donne uniquement la lettre correcte (A, B, C ou D).
`;

  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer 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"
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [{ role: "user", content: prompt }],
        max_tokens: 5 // tr√®s peu pour √©conomiser le cr√©dit
      })
    });

    const data = await response.json();
    const answer = data.choices[0].message.content.trim();

    showResult(answer);

  } catch (err) {
    console.error(err);
    resultDiv.innerHTML = "<div class='answer wrong'>‚ö†Ô∏è Erreur IA</div>";
  }
}

function showResult(answer) {
  resultDiv.innerHTML = `
    <div class="answer correct">
      ‚úÖ Bonne r√©ponse : ${answer}
    </div>
  `;
}
</script>

</body>
</html>