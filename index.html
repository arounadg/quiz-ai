<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Camera FAST</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body {
  margin: 0;
  background: black;
  color: white;
  text-align: center;
  font-family: Arial;
}
video {
  width: 100%;
}
button {
  background: #00e676;
  border: none;
  padding: 15px;
  font-size: 18px;
  border-radius: 10px;
  margin: 10px;
}
#answer {
  font-size: 42px;
  color: #00ff00;
  font-weight: bold;
  animation: blink 1s infinite;
}
@keyframes blink {
  50% { opacity: 0.3; }
}
</style>
</head>

<body>

<h3>‚ö° Quiz Camera FAST</h3>

<video id="video" autoplay playsinline></video>

<button onclick="startCamera()">üé• Cam√©ra</button>
<button onclick="scanFast()">‚ö° Scanner</button>

<div id="answer"></div>

<script>
let video = document.getElementById("video");
let answerDiv = document.getElementById("answer");
let started = false;
let cache = {};

const quizDB = [
  { q: "pib", a: "Produit Int√©rieur Brut" },
  { q: "capitale de la france", a: "Paris" },
  { q: "2 + 2", a: "4" },
  { q: "pr√©sident de la c√¥te d‚Äôivoire", a: "Alassane Ouattara" }
];

// üé• Cam√©ra
async function startCamera() {
  if (started) return;
  started = true;
  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" }
  });
  video.srcObject = stream;
}

// ‚ö° OCR RAPIDE
async function scanFast() {
  answerDiv.innerText = "‚è≥";

  const canvas = document.createElement("canvas");
  const vw = video.videoWidth;
  const vh = video.videoHeight;

  // üéØ zone centrale (50%)
  canvas.width = vw * 0.5;
  canvas.height = vh * 0.3;

  const ctx = canvas.getContext("2d");
  ctx.drawImage(
    video,
    vw * 0.25,
    vh * 0.25,
    vw * 0.5,
    vh * 0.3,
    0,
    0,
    canvas.width,
    canvas.height
  );

  const { data: { text } } = await Tesseract.recognize(
    canvas,
    "fra",
    {
      tessedit_pageseg_mode: 6,
      logger: () => {}
    }
  );

  const clean = text.toLowerCase().trim();

  if (cache[clean]) {
    answerDiv.innerText = cache[clean];
    return;
  }

  for (let q of quizDB) {
    if (clean.includes(q.q)) {
      cache[clean] = q.a;
      answerDiv.innerText = q.a;
      return;
    }
  }

  answerDiv.innerText = "‚ùå";
}
</script>

</body>
</html>
